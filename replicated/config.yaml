apiVersion: kots.io/v1beta1
kind: Config
metadata:
  name: studio-config
spec:
  groups:
    - name: APIs and Credentials
      description: >
        This section configures your API Keys and Credentials
      title: APIs and Credentials
      items:
        - name: studio_image_tag
          type: text
          title: Studio version
          default: "1.1.2"
          help_text: Specifies image tag for Studio
        - name: docker_image_tag
          type: text
          title: Rasa Pro version
          default: 3.7.9
          help_text: Rasa Plus docker image to be used for training
        - name: model_service_image_tag
          type: text
          title: Model services version
          default: "3.2.2"
          help_text: Specifies image tag for Model Service
        - name: openai_api_key
          type: text
          title: OpenAI API key
          default: ""
          required: true
          help_text: OpenAI API key to be used
    - name: Model Services
      description: >
        This section can  be used to configure number of replicas for Model Services
      title: Model Service Replicas
      items:
        - name: training_consumer_replicas
          type: text
          title: Number of training consumer replicas
          default: "2"
          help_text: More information [here](https://rasa.com/docs/studio/deployment/architecture/#:~:text=consumer%20becomes%20available.-,TIP,-The%20number%20of).
        - name: running_consumer_replicas
          type: text
          title: Number of running consumer replicas
          default: "2"
          help_text: More information [here](https://rasa.com/docs/studio/deployment/architecture/#:~:text=consumer%20becomes%20available.-,TIP,-The%20number%20of).
        - name: configure_rasa_resources
          type: bool
          title: Configure Rasa Bot resources
          default: "0"
          help_text: Check this option if you want to configure resource requests/limits for model training/running
        - name: rasa_requests_cpu
          type: text
          title: Rasa requests CPU
          default: "1000m"
          help_text: Value of CPU requests to allocate to the container for model training/running
          when: '{{repl ConfigOptionEquals "configure_rasa_resources" "1"}}'
        - name: rasa_requests_memory
          type: text
          title: Rasa requests memory
          default: "1Gi"
          help_text: Value of Memory requests to allocate to the container for model training/running
          when: '{{repl ConfigOptionEquals "configure_rasa_resources" "1"}}'
        - name: rasa_limits_cpu
          type: text
          title: Rasa limits CPU
          default: "1000m"
          help_text: Value of Memory limits to allocate to the container for model training/running
          when: '{{repl ConfigOptionEquals "configure_rasa_resources" "1"}}'
        - name: rasa_limits_memory
          type: text
          title: Rasa limits memory
          default: "1Gi"
          help_text: Value of Memory limits to allocate to the container for model training/running
          when: '{{repl ConfigOptionEquals "configure_rasa_resources" "1"}}'
    - name: Database
      description: >
        This section can be used to configure the database required by Rasa Studio.
      title: Database
      items:
        - name: postgres_type
          type: select_one
          title: PostgresSQL
          default: embedded_postgres
          items:
            - name: embedded_postgres
              title: Embedded Postgres
            - name: external_postgres
              title: External Postgres
        - name: wait_for_it
          type: bool
          title: Wait for PostgresSQL to be ready
          default: '{{repl (ConfigOptionEquals "postgres_type" "embedded_postgres") | ternary "1" "0"}}'
          when: '{{repl ConfigOptionEquals "postgres_type" "embedded_postgres"}}'
          help_text: Enable this if you are using Embedded PostgresSQL
        - name: database_host
          type: text
          title: Database Host
          required: true
          default: postgresql.postgresql.svc.cluster.local
          help_text: The database host name
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
        - name: database_username
          type: text
          title: Database Username
          required: true
          default: postgres
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
          help_text: The database username
        - name: database_password
          type: text
          title: Database Password
          default: postgres
          required: true
          help_text: The database password
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
        - name: database_port
          type: text
          title: Database port
          required: true
          default: "5432"
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
          help_text: The database port
        - name: model_service_database
          type: text
          title: MTS DB database
          default: modelservice
          help_text: The database name for model training and running service
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
        - name: keycloak_database
          type: text
          title: Keycloak DB database
          default: keycloak
          help_text: The database name for keycloak user management service
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
        - name: prefer_ssl
          type: text
          title: Prefer SSL
          default: "false"
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
          help_text: Set to true if you want to use SSL for db connection
        - name: reject_unauthorized
          type: "text"
          title: Reject Unauthorized
          default: ""
          when: '{{repl ConfigOptionEquals "postgres_type" "external_postgres"}}'
          help_text: If true the server will reject db connection which is not present list of supplied CAs.
    - name: Kafka
      description: >
        This section covers Kafka configuration
      title: Kafka
      items:
        - name: kafka_type
          type: select_one
          title: Kafka
          default: embedded_kafka
          items:
            - name: embedded_kafka
              title: Embedded Kafka
            - name: external_kafka
              title: External Kafka
        - name: kafka_broker
          type: text
          title: Kafka broker address
          default: "kafka.kafka.svc.cluster.local:9092"
          help_text: Kafka broker address
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
        - name: kafka_sasl_mechanism
          type: text
          title: Kafka SASL mechanism
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Supported values are plain, SCRAM-SHA-256 or SCRAM-SHA-512. You can leave it empty if you are not using SASL.
        - name: kafka_username
          type: text
          title: Kafka SASL username
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka SASL username
        - name: kafka_password
          type: text
          title: Kafka SASL password
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          default: kafka
          help_text: Kafka SASL password
        - name: kafka_group_id
          type: text
          title: Kafka group ID
          default: "studio"
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: This is the Kafka group id that should be unique for Studio so that Studio can receive a copy of all the Rasa Pro events streamed to the topic.
        - name: kafka_topic
          type: text
          title: Kafka topic
          default: rasa-events
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka topic to which to Rasa Pro assistant will publish events. Make sure that you pre-create these on your own.
        - name: kafka_dlq_topic
          type: text
          title: Kafka DLQ topic
          default: rasa-events-dlq
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka topic to which unprocessed Rasa Pro assistant events will be pushed by Studio. Make sure that you pre-create these on your own.
        - name: training_result_topic
          type: text
          title: Training result topic
          default: training-result
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka topic for internal service communication. Please make sure to pre-create this topic.
        - name: training_job_topic
          type: text
          title: Training job topic
          default: training-job
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka topic for internal service communication. Please make sure to pre-create this topic.
        - name: kafka_training_status_update_topic
          type: text
          title: Training status update topic
          default: training-status-update
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka topic for internal service communication. Please make sure to pre-create this topic.
        - name: deployment_result_topic
          type: text
          title: Deployment result topic
          default: deployment-result
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka topic for internal service communication. Please make sure to pre-create this topic.
        - name: deployment_job_topic
          type: text
          title: Deployment job topic
          default: deployment-job
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka topic for internal service communication. Please make sure to pre-create this topic.
        - name: kafka_security_protocol
          type: text
          title: Kafka Security Protocol
          default: PLAINTEXT
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Kafka security protocol
        - name: kafka_ssl
          type: text
          title: Kafka Enable SSL
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Set to true if you want to use SSL
        - name: kafka_custom_ssl
          type: text
          title: Kafka custom SSL
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'
          help_text: Set to true if you want to use SSL with custom certs
        - name: kafka_ca_file
          type: text
          title: Kafka CA file
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_custom_ssl" "true"}}'
          help_text: Path to the CA file
        - name: kafka_key_file
          type: text
          title: Kafka key file
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_custom_ssl" "true"}}'
          help_text: Path to the client key file
        - name: kafka_cert_file
          type: text
          title: Kafka certificate file
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_custom_ssl" "true"}}'
          help_text: Path to the client certificate file
        - name: kafka_reject_unauthorized
          type: text
          title: Kafka reject unauthorized
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_custom_ssl" "true"}}'
          help_text: Defaults to true, the server certificate is verified against the list of supplied CA
        - name: node_tls_reject_unauthorized
          type: text
          title: Node TLS reject unauthorized
          default: ""
          when: '{{repl ConfigOptionEquals "kafka_type" "external_kafka"}}'

    - name: Keycloak
      description: >
        This section covers Keycloak section
      title: Keycloak
      items:
        - name: keycloak_realm
          type: text
          title: Keycloak realm
          default: rasa-studio
          hidden: true
          help_text: Keycloak realm name
        - name: keycloak_api_username
          type: text
          title: Keycloak API username
          required: true
          default: realmadmin
          hidden: true
          help_text: These credentials are used by Studio Backend Server to communicate with Keycloak's user management module
        - name: keycloak_api_password
          type: text
          title: Keycloak API password
          required: true
          default: realmadmin
          hidden: true
          help_text: These credentials are used by Studio Backend Server to communicate with Keycloak's user management module
        - name: keycloak_api_client_id
          type: text
          title: Keycloak API client ID
          default: admin-cli
          hidden: true
          help_text: Keycloak API client ID
        - name: keycloak_admin_username
          type: text
          title: Keycloak admin username
          default: "kcadmin"
          help_text: The admin username for Keycloak. This username is used to login to Keycloak admin console.
        - name: keycloak_admin_password
          type: text
          title: Keycloak Admin Password
          required: true
          default: studio
          help_text: The admin password for Keycloak. This password is used to login to Keycloak admin console.
        - name: keycloak_client_id
          type: text
          title: Keycloak Client ID
          default: rasa-studio-backend
          hidden: true
          help_text: Keycloak client id
        - name: keycloak_proxy
          type: text
          title: Keycloak proxy
          hidden: true
          default: "edge"
    - name: Object Storage
      description: >
        This section covers object storage for MTS/MRS
      title: Object Storage
      items:
        - name: bucket_provider
          type: select_one
          title: Bucket Provider
          default: gcp_bucket
          items:
            - name: gcp_bucket
              title: Google Cloud Storage
            - name: aws_bucket
              title: AWS S3 Bucket
        - name: storage_type
          type: text
          title: Storage Type
          default: '{{repl (ConfigOptionEquals "bucket_provider" "gcp_bucket") | ternary "gcs" "aws_s3"}}'
          help_text: Put `gcs` for Google Cloud storage or `aws` for AWS S3 bucket
          hidden: true
        - name: bucket_name
          type: text
          title: Bucket Name
          default: ""
          help_text: Name of the storage bucket. Make sure to pre-create this bucket.
        - name: gcp_credentials
          type: text
          title: GCP SA Base64Encoded
          when: '{{repl ConfigOptionEquals "bucket_provider" "gcp_bucket"}}'
          help_text: GCP credentials for the service account. This is the base64 encoded service account JSON. This is only required if you are using GCS for object storage.
        - name: google_cloud_project
          type: text
          title: Google Cloud project
          default: ""
          when: '{{repl ConfigOptionEquals "bucket_provider" "gcp_bucket"}}'
          help_text: The project ID of the GCP project.
        - name: cloudsdk_compute_zone
          type: text
          title: CloudSDK Compute Zone
          default: ""
          when: '{{repl ConfigOptionEquals "bucket_provider" "gcp_bucket"}}'
          help_text: The zone where the bucket is located.
        - name: url_service_account
          type: text
          title: Storage Signed Url Service Account Email
          default: ""
          when: '{{repl ConfigOptionEquals "bucket_provider" "gcp_bucket"}}'
          help_text: The service account email address.
        - name: aws_access_key_id
          type: text
          title: AWS Access Key ID
          default: ""
          when: '{{repl ConfigOptionEquals "bucket_provider" "aws_bucket"}}'
          help_text: AWS access key ID used for S3
        - name: aws_secret_access_key
          type: text
          title: AWS Secret Access Key
          default: ""
          when: '{{repl ConfigOptionEquals "bucket_provider" "aws_bucket"}}'
          help_text: AWS secret access key ID used for S3
        - name: aws_region_name
          type: text
          title: AWS Region Name
          default: ""
          when: '{{repl ConfigOptionEquals "bucket_provider" "aws_bucket"}}'
          help_text: The region where the bucket is located.
    - name: NFS
      description: >
        This section covers NFS server configuration
      title: NFS Server
      items:
        - name: nfs_type
          type: select_one
          title: NFS Server
          default: embedded_nfs
          items:
            - name: embedded_nfs
              title: Embedded NFS
            - name: external_nfs
              title: External NFS
        - name: persistence_type
          type: text
          title: Persistence Type
          default: '{{repl (ConfigOptionEquals "nfs_type" "embedded_nfs") | ternary "local" ""}}'
          help_text: Type of the volume that will be used to store the training data. Valid value is `nfs`. Leave this empty if you are using AWS EFS.
          when: '{{repl ConfigOptionEquals "nfs_type" "external_nfs"}}'
        - name: nfs_aws_type
          type: bool
          title: Using AWS NFS
          default: "0"
          when: '{{repl ConfigOptionEquals "nfs_type" "external_nfs"}}'
          help_text: Please check this if you are using AWS NFS
        - name: efs_id
          type: text
          title: AWS EFS volume ID
          default: ""
          help_text: Fill this if you are using AWS NFS. `FileSystemId::MountPoint` of the AWS EFS volume. For example `fs-0bbaea252301ca2d4::fsap-0b4550cc4c77377fd`.
          when: '{{repl ConfigOptionEquals "nfs_aws_type" "1"}}'
        - name: host_path
          type: text
          title: Host Path
          default: /
          help_text: Directory from the host machine that will be mounted to the container for training data.
          when: '{{repl ConfigOptionEquals "nfs_type" "embedded_nfs"}}'
        - name: local_node_name
          type: text
          title: Local Node Name
          default: ""
          help_text: Node on which the PV will be created
          when: '{{repl ConfigOptionEquals "nfs_type" "embedded_nfs"}}'
        - name: storage_class_name
          type: text
          title: Storage Class name
          default: "openebs-hostpath"
          help_text: Storage Class name for PV. Should be `efs-sc` if you are using AWS EFS. It's `standard-rwo` if you are using NFS server.
          when: '{{repl ConfigOptionEquals "nfs_type" "external_nfs"}}'
        - name: storage_capacity
          type: text
          title: Storage Capacity
          default: 1Gi
          when: '{{repl ConfigOptionEquals "nfs_type" "external_nfs"}}'
          help_text: Storage Capacity for PV
        - name: storage_requests
          type: text
          title: Storage Requests
          default: 1Gi
          when: '{{repl ConfigOptionEquals "nfs_type" "external_nfs"}}'
          help_text: Storage requests for PVC
        - name: nfs_server
          type: text
          title: NFS Server Address
          default: ""
          help_text:  DNS name or IP address of the NFS server. This value is used only when type is set to nfs
          when: '{{repl ConfigOptionEquals "nfs_type" "external_nfs"}}'
    - name: Ingress
      description: >
        This section covers Ingress configuration
      title: Ingress
      items:
        - name: install_nginx
          type: select_one
          title: Deploy on
          default: on_vm
          items:
            - name: on_vm
              title: Virtual Machine
            - name: on_kubernetes
              title: Kubernetes
            - name: no_ingress
              title: Do not install
        - name: ingress_hostname
          type: text
          title: Ingress DNS Hostname
          default: ""
          help_text: Defines the host name for all the Studio ingress resources. Make sure you provide a valid host name.
        - name: connection_type
          type: text
          title: Connection type
          default: http
          help_text: Define if you will be using https or http with the ingressHost
        - name: ingress_class
          type: text
          title: Ingress Class Name
          default: nginx
          help_text: Ingress class name
          when: '{{repl ConfigOptionEquals "install_nginx" "no_ingress"}}'
        - name: annotations
          type: textarea
          title: Annotations
          help_text: |
            Use this textarea to provide annotations specific to your ingress controller.
            For example, `kubernetes.io/tls-acme: true`.
          default: ""
